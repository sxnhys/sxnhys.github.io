<!DOCTYPE html>
<html lang="z">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>符合Python风格的对象 | Sxnys Notes</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="好高骛远，一事无成&lt;br&gt;我想学Python">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="符合Python风格的对象 | Sxnys Notes">
    <meta name="twitter:description" content="好高骛远，一事无成&lt;br&gt;我想学Python">

    <meta property="og:type" content="article">
    <meta property="og:title" content="符合Python风格的对象 | Sxnys Notes">
    <meta property="og:description" content="好高骛远，一事无成&lt;br&gt;我想学Python">

    
    <meta name="author" content="Sxnys">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/favicon.jpg">
    

    <meta name="generator" content="hexo"/>
    

    <link rel="canonical" href="http://yoursite.com/2019/01/02/9_符合Python风格的对象/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 Sxnys Notes 的主页"><img src="/images/logo.jpg" width="80" alt="Sxnys Notes logo" class="panel-cover__logo logo"></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Sxnys Notes">Sxnys Notes</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">人生苦短</span>
        
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">好高骛远，一事无成<br>我想学Python</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="Visit the blog" class="blog-button">Blog</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="https://weibo.com/u/3926121193" title="Weibo" target="_blank">
      <i class="social fa fa-weibo"></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/sxnys" title="GitHub" target="_blank">
      <i class="social fa fa-github"></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2019-01-02T11:29:27.564Z" class="post-list__meta--date date">2019-01-02</time> &#8226; <span class="post-meta__tags tags">于 
  <a class="tag-link" href="/tags/Fluent-Python/">Fluent Python</a>, <a class="tag-link" href="/tags/Python/">Python</a>
 </span>
      <span class="page-pv">
       Read <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">符合Python风格的对象</h1>
  </header>

  <section class="post">
    <hr>
<p>基于 Python 的数据模型，自定义类型可以实现和内置类型一样自然的行为，实际上靠的是 <strong>鸭子类型</strong>。</p>
<blockquote>
<p>鸭子类型：按照预定行为实现对象所需的方法</p>
</blockquote>
<h2 id="0、最初的Vector类"><a href="#0、最初的Vector类" class="headerlink" title="0、最初的Vector类"></a><strong>0、最初的Vector类</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> hypot 	 <span class="comment"># 两个数平方和开方</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x=<span class="number">0</span>, y=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>     <span class="comment"># 字符串表示形式</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Vector(%r, %r)'</span> % (self.x, self.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hypot(self.x, self.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(abs(self))</span><br><span class="line">        <span class="comment"># OR return bool(self.x or self.y)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Vector(self.x + other.x, self.y + other.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span><span class="params">(self, scalar)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Vector(self.x * scalar, self.y * scalar)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="1、对象表现形式"><a href="#1、对象表现形式" class="headerlink" title="1、对象表现形式"></a><strong>1、对象表现形式</strong></h2><p>Python 提供了两种获取对象的<strong>字符串表现形式</strong>的标准方式：</p>
<blockquote>
<p><code>repr()</code> ：便于开发者理解的方式返回对象字符串表现形式，由 <code>__repr__</code> 特殊方法提供支持<br><code>str()</code> ：便于用户理解的方式返回对象字符串表现形式，由 <code>__str__</code> 特殊方法提供支持</p>
</blockquote>
<p>为了给对象提供其他的表现形式，还涉及到另外两个特殊方法：</p>
<blockquote>
<p><code>__bytes__</code> ：与 <code>__str__</code> 类似；<code>bytes()</code> 调用它获取对象的 <strong>字节序列表现形式</strong><br><code>__format__</code> ：被内置的 <code>format()</code> 函数和 <code>str.format()</code> 方法调用，使用特殊的格式代码显示对象的字符串表现形式</p>
</blockquote>
<p>! PS:</p>
<blockquote>
<p>Python3 中，<code>__repr__</code>、<code>__str__</code>、<code>__format__</code> 都必须返回 <strong>Unicode 字符串</strong> (<code>str</code> 类型)；<code>__bytes__</code> 返回 <strong>字节序列</strong> (<code>bytes</code> 类型)</p>
</blockquote>
<hr>
<h2 id="2、Vector-v0"><a href="#2、Vector-v0" class="headerlink" title="2、Vector v0"></a><strong>2、Vector v0</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector2d</span>:</span></span><br><span class="line">    typecode = <span class="string">'d'</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尽早转换为float，尽早捕获错误，防止传入非法参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.x = float(x)</span><br><span class="line">        self.y = float(y)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 实现可迭代，用于拆包</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (i <span class="keyword">for</span> i <span class="keyword">in</span> (self.x, self.y))    <span class="comment"># OR yield self.x; yield self.y</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># !r 获取各个分量的表现形式</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        class_name = type(self).__name__     <span class="comment"># OR self.__class__.__name__</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&#123;&#125;(&#123;!r&#125;, &#123;!r&#125;)'</span>.format(class_name, *self)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 因为可迭代，可以根据实例得到元组</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(tuple(self))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bytes__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bytes([ord(self.typecode)]) + bytes(array(self.typecode, self))   <span class="comment"># 可迭代，可以根据实例得到数组</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> tuple(self) == tuple(other)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.hypot(*self)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(abs(self))</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod   # 定义类方法：从字节序列转换成该类的实例</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">frombytes</span><span class="params">(cls, octets)</span>:</span></span><br><span class="line">        typecode = chr(octets[<span class="number">0</span>])</span><br><span class="line">        memv = memoryview(octets[<span class="number">1</span>:]).cast(typecode)    <span class="comment"># 传入 octets 字节序列创建一个内存视图，使用 typecode 转换</span></span><br><span class="line">        <span class="keyword">return</span> cls(*memv)                          <span class="comment"># 拆包内存视图得到一对参数传入构造方法</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1 = Vector2d(<span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 无需调用读值方法，直接通过属性访问 Vertor 实例的分量</span></span><br><span class="line">print(v1.x, v1.y)</span><br></pre></td></tr></table></figure>
<pre><code># Out
3.0 4.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 因为可迭代，可以拆包成变量元组</span></span><br><span class="line">x, y = v1</span><br><span class="line">x, y</span><br></pre></td></tr></table></figure>
<pre><code># Out
(3.0, 4.0)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># repr 字符串表现形式</span></span><br><span class="line">v1</span><br></pre></td></tr></table></figure>
<pre><code># Out
Vector2d(3.0, 4.0)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 eval 表明 repr 函数调用实例得到的是对构造方法的准确表述</span></span><br><span class="line">v1_clone = eval(repr(v1))</span><br><span class="line">v1 == v1_clone</span><br></pre></td></tr></table></figure>
<pre><code># Out
True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># str 字符串表现形式</span></span><br><span class="line">print(v1)</span><br></pre></td></tr></table></figure>
<pre><code># Out
(3.0, 4.0)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 二进制表现形式</span></span><br><span class="line">bytes(v1)</span><br></pre></td></tr></table></figure>
<pre><code># Out
b&apos;d\x00\x00\x00\x00\x00\x00\x08@\x00\x00\x00\x00\x00\x00\x10@&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Vertor模值</span></span><br><span class="line">abs(v1)</span><br></pre></td></tr></table></figure>
<pre><code># Out
5.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 布尔值</span></span><br><span class="line">bool(v1), bool(Vector2d(<span class="number">0</span>, <span class="number">0</span>))</span><br></pre></td></tr></table></figure>
<pre><code># Out
(True, False)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字节序列转换成实例</span></span><br><span class="line">v2 = Vector2d.frombytes(bytes(v1))</span><br><span class="line">v2</span><br></pre></td></tr></table></figure>
<pre><code># Out
Vector2d(3.0, 4.0)
</code></pre><hr>
<h2 id="3、classmethod-和-staticmethod"><a href="#3、classmethod-和-staticmethod" class="headerlink" title="3、classmethod 和 staticmethod"></a><strong>3、<code>classmethod</code> 和 <code>staticmethod</code></strong></h2><p>两者都是装饰器</p>
<blockquote>
<p><code>classmethod</code> ：定义操作类的方法（类方法），而不是操作实例；类方法的第一个参数是类本身；最常见的用途是定义备选构造方法（Vector v0 中的<code>frombytes</code> 方法）<br><code>staticmethod</code> ：静态方法，其实就是普通函数，只不过在类的定义体中定义，而不在模块层定义</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">klassmeth</span><span class="params">(*args)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">statmeth</span><span class="params">(*args)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> args</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 类方法的第一个参数始终是类本身</span></span><br><span class="line">Demo.klassmeth(), Demo.klassmeth(<span class="string">'spam'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
((__main__.Demo,), (__main__.Demo, &apos;spam&apos;))
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 静态方法的行为和普通函数相似</span></span><br><span class="line">Demo.statmeth(), Demo.statmeth(<span class="string">'spam'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
((), (&apos;spam&apos;,))
</code></pre><hr>
<h2 id="4、格式化显示"><a href="#4、格式化显示" class="headerlink" title="4、格式化显示"></a><strong>4、格式化显示</strong></h2><ul>
<li>内置的 <code>format()</code> 函数和 <code>str.format()</code> 方法把各个类型的格式化方式委托给相应的 <code>__format__(format_spec)</code> 方法。    </li>
<li><code>format_spec</code> —— 格式说明符，使用 <strong>格式规范微语言</strong>（Format Specification Mini-Language）表示法：<blockquote>
<p><code>format(obj, format_spec)</code> 的第二个参数<br><code>str.format()</code> 方法的格式字符串中，<code>{}</code> 里冒号之后的部分    </p>
</blockquote>
</li>
</ul>
<p>它和 % 格式化方法 % 后面的部分基本一样，但是有所不同（如对齐方式）<br>详细的格式化符号及用法见 <a href="https://docs.python.org/3/library/string.html#formatstrings" title="Format String Syntax" target="_blank" rel="noopener">官方文档</a> 和 <a href="https://www.cnblogs.com/fat39/p/7159881.html" title="Python 格式化输出" target="_blank" rel="noopener">fat39 的博客</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brl = <span class="number">1</span> / <span class="number">2.43</span></span><br><span class="line">brl</span><br></pre></td></tr></table></figure>
<pre><code># Out
0.4115226337448559
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(brl, <span class="string">'0.4f'</span>)   <span class="comment"># 0可以省略</span></span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;0.4115&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'1 BRL = &#123;rate:^15.2e&#125; USD'</span>.format(rate=brl)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;1 BRL =    4.12e-01     USD&apos;
</code></pre><p>上例中的 <code>0.4f</code> 和 <code>^15.2e</code>（取小数点后两位，科学计数法表示，居中并占15个位置单位）就是 <code>format_spec</code></p>
<blockquote>
<p>类似于 <code>{0.attr:5.3e}</code> 这样的格式字符串包括两个部分：     </p>
<ul>
<li>冒号前的是 <strong>字段名</strong>，可以是数字表示，也可以是有具体含义的名称，如果它是某个类的实例并且要使用它的某个属性，可以使用 <code>.</code> 来获取</li>
<li>冒号后的就是 <strong>格式说明符</strong> (<code>format_spec</code>)</li>
</ul>
</blockquote>
<h4 id="4-种十进制转十六进制的写法"><a href="#4-种十进制转十六进制的写法" class="headerlink" title="4 种十进制转十六进制的写法"></a><strong>4 种十进制转十六进制的写法</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. hex 内置函数</span></span><br><span class="line">hex(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;0x64&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. % 格式化</span></span><br><span class="line"><span class="string">'%x'</span> % <span class="number">100</span></span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;64&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3. format 函数</span></span><br><span class="line">format(<span class="number">100</span>, <span class="string">'x'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;64&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4. str.format() 方法</span></span><br><span class="line"><span class="string">'&#123;:x&#125;'</span>.format(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;64&apos;
</code></pre><p>二进制、八进制、十进制、十六进制 之间都可以用上述类似的方法相互转换。格式规范微语言为这些内置类型提供了专用的表示代码（如十六进制的 x）</p>
<blockquote>
<p>格式规范微语言是可扩展的，每个类可以自行决定如何解释 <code>format_spec</code> 参数<br>如 <code>datetime</code> 模块中的类，它们的 <code>__format__</code> 方法使用的格式代码和 <code>strftime()</code> 函数一样</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">now = datetime.now()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(now, <span class="string">'%Y-%m-%d  %H:%M:%S'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;2018-12-28  20:52:25&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"It's now &#123;:%I:%M %p&#125;"</span>.format(now)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&quot;It&apos;s now 08:52 PM&quot;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">now.strftime(<span class="string">'Today is %D'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;Today is 12/28/18&apos;
</code></pre><blockquote>
<p>如果类没有定义 <code>__format__</code> 方法，从 <code>object</code> 继承的方法会返回 <code>str(my_object)</code>，但是如果传入格式说明符就会抛出 <code>TypeError</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(v1)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;(3.0, 4.0)&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(v1, <span class="string">'.3f'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

&lt;ipython-input-87-9f7764dc3848&gt; in &lt;module&gt;()
----&gt; 1 format(v1, &apos;.3f&apos;)


TypeError: unsupported format string passed to Vector2d.__format__
</code></pre><blockquote>
<p>自定义的格式代码选择字母时应该避免其他类型用过的     </p>
<ul>
<li>整数使用的代码：<code>&#39;bcdoXn&#39;</code></li>
<li>浮点数使用的代码：<code>&#39;eEfFgGn%&#39;</code></li>
<li>字符串使用的代码：<code>&#39;s&#39;</code></li>
</ul>
</blockquote>
<p>在现有的 Vector 类的基础上实现自定义格式化，包括两点：</p>
<ol>
<li>一般的格式化，分别进行向量两个分量的格式化，返回形式 <code>(fmt_x, fmt_y)</code></li>
<li>格式化为极坐标，选用代码 <code>&#39;p&#39;</code>，返回形式 <code>&lt;r, θ&gt;</code>（ <code>r</code> 是模长，即已经实现的 <code>__abs__</code> 方法；<code>θ</code> 是弧度）</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算弧度</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">angle</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> math.atan2(self.y, self.x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__format__</span><span class="params">(self, fmt_spec=<span class="string">''</span>)</span>:</span></span><br><span class="line">    <span class="comment"># 格式化为极坐标</span></span><br><span class="line">    <span class="keyword">if</span> fmt_spec.endwith(<span class="string">'p'</span>):</span><br><span class="line">        fmt_spec = fmt_spec[:<span class="number">-1</span>]</span><br><span class="line">        coords = (abs(self), self.angle())</span><br><span class="line">        outer_fmt = <span class="string">'&lt;&#123;&#125;, &#123;&#125;&gt;'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        coords = self</span><br><span class="line">        outer_fmt = <span class="string">'(&#123;&#125;, &#123;&#125;)'</span></span><br><span class="line">    components = (format(c, fmt_spec) <span class="keyword">for</span> c <span class="keyword">in</span> coords)</span><br><span class="line">    <span class="keyword">return</span> outer_fmt.format(*components)</span><br></pre></td></tr></table></figure>
<p><strong><em>关于自定义格式化的完整代码和测试，和之后的内容一起给出（不然代码会重复冗长）</em></strong></p>
<hr>
<h2 id="5、可散列的Vector"><a href="#5、可散列的Vector" class="headerlink" title="5、可散列的Vector"></a><strong>5、可散列的Vector</strong></h2><blockquote>
<p>类的实例可散列，需要满足以下三个条件：   </p>
<ol>
<li>实例不可变</li>
<li>实现 <code>__hash__</code> 方法</li>
<li>实现 <code>__eq__</code> 方法</li>
</ol>
</blockquote>
<p><strong> 针对 Vector 类实现以上三个条件 </strong></p>
<h4 id="1-实例不可变"><a href="#1-实例不可变" class="headerlink" title="1. 实例不可变"></a><strong>1. 实例不可变</strong></h4><p>使用 <strong>私有属性</strong> 和 <strong><code>property</code></strong> 装饰器，将向量的两个分量设为<strong>只读属性</strong>，来保证实例“不可变”（因为属性不是真正的私有，所以不是真正的不可变）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector2d</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.__x = float(x)</span><br><span class="line">        self.__y = float(y)</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">x</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__x</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">y</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__y</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (i <span class="keyword">for</span> i <span class="keyword">in</span> (self.x, self.y))</span><br></pre></td></tr></table></figure>
<ul>
<li>两个前导下划线标记属性为私有</li>
<li><code>@property</code> 装饰器把读值方法标记为属性（方法名可以当作属性来使用，它们就是公共属性，就像 <code>__iter__</code> 方法里面用的那样）</li>
<li>之所以要实例不可变，是因为要实现 <code>__hash__</code> 方法和 <code>__eq__</code> 方法，保证相等的对象具有相同的散列值</li>
</ul>
<h4 id="2-实现-hash-方法"><a href="#2-实现-hash-方法" class="headerlink" title="2. 实现 __hash__ 方法"></a><strong>2. 实现 <code>__hash__</code> 方法</strong></h4><p><code>__hash__</code> 方法应该返回一个整数，根据<a href="https://docs.python.org/3/reference/datamodel.html" target="_blank" rel="noopener">官方的文档</a>，建议返回<strong>各分量散列值的异或值</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hash(self.x) ^ hash(self.y)</span><br></pre></td></tr></table></figure>
<h4 id="3-实现-eq-方法"><a href="#3-实现-eq-方法" class="headerlink" title="3. 实现 __eq__ 方法"></a><strong>3. 实现 <code>__eq__</code> 方法</strong></h4><p>之前已经实现      </p>
<p><br></p>
<p><strong><em>关于可散列 Vector 的完整代码和测试，和之后的内容一起给出（不然代码会重复冗长）</em></strong></p>
<hr>
<h2 id="6、“私有”属性和“受保护”的属性"><a href="#6、“私有”属性和“受保护”的属性" class="headerlink" title="6、“私有”属性和“受保护”的属性"></a><strong>6、“私有”属性和“受保护”的属性</strong></h2><blockquote>
<p>首先说明一点，Python 中没有像 Java 中那样的类似于 <code>private</code> 的限定修饰符，所以没有真正的实现私有和受保护，而是一种防护措施，更像是一种越定，就好比在 Java 中“私有”是法律规定，而在 Python 中“私有” 是道德规范。</p>
</blockquote>
<blockquote>
<ul>
<li>私有属性：防止某个属性在被直接使用或者是创建子类时被覆盖。Python 中使用两个前导下划线（尾部没有或者最多有一个下划线）命名的属性就是私有属性。</li>
<li>名称改写：被命名为私有的属性，会被内部改写成 <code>_class__attr</code> 的形式，被存入实例的 <code>__dict__</code> 属性中。</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.__x = x</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">x</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__x</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.x = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<pre><code># Out
---------------------------------------------------------------------------

AttributeError                            Traceback (most recent call last)

&lt;ipython-input-10-4930f24ffcf0&gt; in &lt;module&gt;()
----&gt; 1 a.x = 2


AttributeError: can&apos;t set attribute
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = A(<span class="number">1</span>)</span><br><span class="line">a.__dict__</span><br></pre></td></tr></table></figure>
<pre><code># Out
{&apos;_A__x&apos;: 1}
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a._A__x = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>所以实际上私有属性的名称改写仅仅是一种防护措施，避免无意地覆盖了我们所想的变量，但是如果是要故意通过改写后的名称来覆盖属性也没有被禁止。<br>一种比较好的处理属性的方案就是用 <strong>私有属性</strong> + <strong>@property</strong> 装饰器，不去使用改名后的名称，而是使用我们真正想命名的名称。</p>
<blockquote>
<p>对于前导单下划线的属性，Python 不会做任何处理，但却是一个不成文的约定，约定它是一个“私有的”或者是“受保护的”属性，避免意外覆盖属性。但是需要注意的是，不能用 <code>from module import *</code> 导入</p>
</blockquote>
<hr>
<h2 id="7、-slots-类属性"><a href="#7、-slots-类属性" class="headerlink" title="7、__slots__ 类属性"></a><strong>7、<code>__slots__</code> 类属性</strong></h2><p><strong><em>慎用</em></strong></p>
<blockquote>
<ul>
<li><code>__slots__</code> 类属性，在处理百万个属性不多的实例时，能够节省大量内存，它让解释器在元组中存储实例属性来代替字典（<code>__dict__</code>）；   </li>
<li><code>__slots__</code> 类属性的值设为一个字符串构成的可迭代对象，一般是元组，其中每个元素表示各个实例属性；    </li>
<li>在类中定义了 <code>__slots__</code> 属性后，实例不能再有 <code>__slots__</code> 中所列名称之外的其他属性；但是不要滥用它来禁止类的用户新增实例属性；    </li>
<li>如果把 <code>&#39;__dict__&#39;</code> 加入到 <code>__slots__</code> 中，实例会在元组中保存各个实例的属性，也会支持动态创建属性，存在 <code>__dict__</code> 中；</li>
<li><code>__weakref__</code> 实例属性为了让对象支持弱引用，自定义类中默认就有，但是如果定义了 <code>__slots__</code> 属性，而且想支持弱引用，必须把 <code>&#39;__weakref__&#39;</code> 加入 <code>__slots__</code> 中。</li>
</ul>
</blockquote>
<hr>
<h2 id="8、覆盖类属性"><a href="#8、覆盖类属性" class="headerlink" title="8、覆盖类属性"></a><strong>8、覆盖类属性</strong></h2><blockquote>
<p>Python 独特的特性：<strong>类属性可用于为实例属性提供默认值</strong></p>
</blockquote>
<p>就像 Vector 类中的 <code>typecode</code> 属性，定义为了类属性，并且可以通过 <code>self.typecode</code> 来访问。</p>
<blockquote>
<ul>
<li>如果实例本身并没有这个属性，就会使用类的同名属性，否则会用实例自己的属性</li>
<li>为不存在的 <strong>实例属性</strong> 赋值，会新建 <strong>实例属性</strong>，并且同名 <strong>类属性</strong> 不受影响    </li>
<li>要修改 <strong>类属性</strong> 的值，必须直接通过类获取它然后修改，不能通过实例修改</li>
</ul>
</blockquote>
<blockquote>
<p>一个更符合 Python 风格的覆盖类属性的方法：<strong>创建一个子类，只用于定制类的数据属性</strong> （e.g. Django 基于子类的视图）</p>
</blockquote>
<hr>
<h2 id="最终的Vector类代码以及测试"><a href="#最终的Vector类代码以及测试" class="headerlink" title="- 最终的Vector类代码以及测试 -"></a><strong>- 最终的Vector类代码以及测试 -</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector2d</span>:</span></span><br><span class="line">    typecode = <span class="string">'d'</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.__x = float(x)</span><br><span class="line">        self.__y = float(y)</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">x</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__x</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">y</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__y</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (i <span class="keyword">for</span> i <span class="keyword">in</span> (self.x, self.y))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        class_name = type(self).__name__</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&#123;&#125;(&#123;!r&#125;, &#123;!r&#125;)'</span>.format(class_name, *self)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(tuple(self))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bytes__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bytes([ord(self.typecode)]) + bytes(array(self.typecode, self))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> tuple(self) == tuple(other)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hash(self.x) ^ hash(self.y)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.hypot(*self)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(abs(self))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">angle</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.atan2(self.y, self.x)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__format__</span><span class="params">(self, fmt_spec)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> fmt_spec.endswith(<span class="string">'p'</span>):</span><br><span class="line">            fmt_spec = fmt_spec[:<span class="number">-1</span>]</span><br><span class="line">            coords = (abs(self), self.angle())</span><br><span class="line">            outer_fmt = <span class="string">'&lt;&#123;&#125;, &#123;&#125;&gt;'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            coords = self</span><br><span class="line">            outer_fmt = <span class="string">'(&#123;&#125;, &#123;&#125;)'</span></span><br><span class="line">        components = (format(c, fmt_spec) <span class="keyword">for</span> c <span class="keyword">in</span> coords)</span><br><span class="line">        <span class="keyword">return</span> outer_fmt.format(*components)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">frombytes</span><span class="params">(cls, octets)</span>:</span></span><br><span class="line">        typecode = chr(octets[<span class="number">0</span>])</span><br><span class="line">        memv = memoryview(octets[<span class="number">1</span>:]).cast(typecode)</span><br><span class="line">        <span class="keyword">return</span> cls(*memv)</span><br></pre></td></tr></table></figure>
<h4 id="格式化测试"><a href="#格式化测试" class="headerlink" title="格式化测试"></a>格式化测试</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v1 = Vector2d(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">format(v1)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;(3.0, 4.0)&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(v1, <span class="string">'.2f'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;(3.00, 4.00)&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(v1, <span class="string">'.3e'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;(3.000e+00, 4.000e+00)&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(v1, <span class="string">'p'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;&lt;5.0, 0.9272952180016122&gt;&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(v1, <span class="string">'.3ep'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;&lt;5.000e+00, 9.273e-01&gt;&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(v1, <span class="string">'0.5fp'</span>)</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;&lt;5.00000, 0.92730&gt;&apos;
</code></pre><h4 id="hash-测试"><a href="#hash-测试" class="headerlink" title="hash 测试"></a>hash 测试</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v2 = Vector2d(<span class="number">5</span>, <span class="number">12</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash(v1), hash(v2)</span><br></pre></td></tr></table></figure>
<pre><code># Out
(7, 9)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(set([v1, v2]))</span><br></pre></td></tr></table></figure>
<pre><code># Out
2
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;&#125;</span><br><span class="line">d[v1] = <span class="string">'Python'</span></span><br><span class="line">d[Vector2d(<span class="number">3.0</span>, <span class="number">4.0</span>)]</span><br></pre></td></tr></table></figure>
<pre><code># Out
&apos;Python&apos;
</code></pre><p><br></p>
<p><a href="https://nbviewer.jupyter.org/github/sxnys/mypython/blob/master/FluentPython/9_Pythonic_Object/1_pythonic_object.ipynb" target="_blank" rel="noopener">md效果不好，原先是 jupyter notebook 版本</a></p>

  </section>

</article>

<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Newer Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2019/01/02/5_Python变量/" title="Python变量">Python变量</a></h2>
                <p class="excerpt">
                
                
变量
Python中，变量只是一个标注（标签），而不是一个盒子（box）。    

Python中的变量类似于C++、Java等中的引用变量。Important! 这里谈到的变量是容器序列（list、tuple、dict、set …），扁平序列（str、bytes …）有所不同。
翻译一下就是，
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2019-01-02T11:29:27.564Z" class="post-list__meta--date date">2019-01-02</time> &#8226; <span class="post-list__meta--tags tags">于 
  <a class="tag-link" href="/tags/Fluent-Python/">Fluent Python</a>, <a class="tag-link" href="/tags/Python/">Python</a>
</span><a class="btn-border-small" href="/2019/01/02/5_Python变量/">继续阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Older Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2019/01/02/8_Python垃圾回收和弱引用/" title="Python垃圾回收和弱引用">Python垃圾回收和弱引用</a></h2>
                <p class="excerpt">
                
                
垃圾回收
引用计数 ：CPython 中的主要垃圾回收算法，每个对象都会统计有多少引用指向自己；当引用计数归零时，对象立即销毁。
分代垃圾回收 ：CPython 2.0 增加的新的算法，用于检测引用循环中涉及的对象组    

即将销毁实例时，解释器会调用 __del__ 方法，给实例最后的机会，
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2019-01-02T11:29:27.564Z" class="post-list__meta--date date">2019-01-02</time> &#8226; <span class="post-list__meta--tags tags">于 
  <a class="tag-link" href="/tags/Fluent-Python/">Fluent Python</a>, <a class="tag-link" href="/tags/Python/">Python</a>
</span><a class="btn-border-small" href="/2019/01/02/8_Python垃圾回收和弱引用/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

  

            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2019 Sxnys - 本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
       
    </span>
    <span class="footer__copyright">
             - 基于 <a href="http://hexo.io">Hexo</a> 搭建，使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题，由<a href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
         </span>
       
    
    
</footer>


        </div>
    </div>

     
    


    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
